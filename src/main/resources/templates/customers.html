<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <title>Customer Management</title>

  <!-- Fonts + Bootstrap + Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet"/>

  <style>
    :root {
      --radius: 14px;
      --soft-shadow: 0 10px 28px rgba(0,0,0,.08);
    }
    body {
      font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: linear-gradient(180deg,#f5f7fa 0%,#eef2f7 100%);
      color: #111827;
    }
    .page-header {
      border-radius: var(--radius);
      box-shadow: var(--soft-shadow);
      border: 1px solid rgba(0,0,0,.06);
      background: rgba(255,255,255,.8);
      backdrop-filter: blur(6px);
    }
    .card {
      border-radius: var(--radius);
      border: 1px solid rgba(0,0,0,.06);
      box-shadow: var(--soft-shadow);
    }
    .badge-soft {
      background: #eef2ff; color: #1d4ed8; border: 1px solid #dbeafe;
      border-radius: 999px;
    }
    .table thead th {
      text-transform: uppercase;
      letter-spacing: .04em;
      font-size: .78rem;
      color: #64748b;
      background: #f8fafc;
      position: sticky; top: 0; z-index: 1;
    }
    .empty {
      border:2px dashed #e5e7eb; border-radius: var(--radius);
      background: #fff; padding: 2rem; text-align: center;
      color:#64748b;
    }
    .form-label .req { color:#ef4444; }
    .muted { color:#6b7280; }
    .btn-link {
      text-decoration: none;
    }
  </style>
</head>
<body>
  <div class="container-xxl py-4">

    <!-- Header -->
    <div class="page-header d-flex align-items-center justify-content-between p-3 mb-4">
      <div class="d-flex align-items-center gap-3">
        <i class="bi bi-people fs-4 text-primary"></i>
        <div>
          <h4 class="mb-0 fw-semibold">Customer Management</h4>
          <div class="small text-secondary">Create, edit, and manage your customers</div>
        </div>
      </div>
      <div class="d-flex align-items-center gap-2">
        <a th:href="@{/sales}" class="btn btn-outline-secondary btn-sm">
          <i class="bi bi-arrow-left-short me-1"></i> Back to Sales
        </a>
        <a th:href="@{/dashboard}" class="btn btn-outline-primary btn-sm">
          <i class="bi bi-speedometer2 me-1"></i> Dashboard
        </a>
      </div>
    </div>

    <div class="row g-4">
      <!-- Add / Edit Customer -->
      <div class="col-lg-5">
        <div class="card">
          <div class="card-body">
            <div class="d-flex align-items-center justify-content-between mb-2">
              <h6 class="mb-0" th:text="${customer != null and customer.id != null} ? 'Edit Customer' : 'Add New Customer'"></h6>
              <!-- <span class="badge badge-soft">
                <i class="bi bi-person-plus me-1"></i>
                <span th:text="${customer != null and customer.id != null} ? 'Editing' : 'Create'">Create</span>
              </span> -->
            </div>

            <!-- Flash messages -->
            <div th:if="${success}" class="alert alert-success d-flex align-items-center py-2">
              <i class="bi bi-check-circle me-2"></i>
              <span th:text="${success}"></span>
            </div>
            <div th:if="${error}" class="alert alert-danger d-flex align-items-center py-2">
              <i class="bi bi-exclamation-triangle me-2"></i>
              <span th:text="${error}"></span>
            </div>

            <form th:action="@{/customers/add}" th:object="${customer}" method="post" class="needs-validation" novalidate>
              <input type="hidden" th:field="*{id}" />

              <div class="mb-3">
                <label class="form-label fw-semibold">Name <span class="req">*</span></label>
                <input type="text" class="form-control" th:field="*{name}" required />
                <div class="invalid-feedback">Customer name is required.</div>
              </div>

              <div class="mb-3">
                <label class="form-label fw-semibold">Contact <span class="req">*</span></label>
                <input type="text" class="form-control" th:field="*{contact}" required />
                <div class="invalid-feedback">Contact is required.</div>
                <div class="form-text muted">Phone or any primary contact detail.</div>
              </div>

              <div class="mb-3">
                <label class="form-label fw-semibold">Email</label>
                <input type="email" class="form-control" th:field="*{email}" />
                <div class="form-text muted">Optional, used for invoices/receipts.</div>
              </div>

              <div class="mb-3">
                <label class="form-label fw-semibold">Address</label>
                <input type="text" class="form-control" th:field="*{address}" />
              </div>

              <div class="mb-3">
                <label class="form-label fw-semibold">PAN Number</label>
                <input type="text" class="form-control" th:field="*{panNumber}" placeholder="e.g., ABCDE1234F" />
                <div class="form-text muted">Optional, used for tax invoices.</div>
              </div>

              <div class="mb-3">
                <label class="form-label fw-semibold">VAT Number</label>
                <input type="text" class="form-control" th:field="*{vatNumber}" placeholder="e.g., VAT123456789" />
                <div class="form-text muted">Optional, used for tax invoices.</div>
              </div>

              <div class="d-flex align-items-center justify-content-end gap-2">
                <a th:href="@{/customers}" class="btn btn-outline-secondary">
                  <i class="bi bi-arrow-counterclockwise me-1"></i> Reset
                </a>
                <button type="submit" class="btn btn-primary">
                  <i class="bi bi-save2 me-1"></i>
                  <span th:text="${customer != null and customer.id != null} ? 'Update Customer' : 'Add Customer'">Add Customer</span>
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- Customers List -->
      <div class="col-lg-7">
        <div class="card">
          <div class="card-body">
            <div class="d-flex flex-wrap align-items-center justify-content-between mb-2">
              <h6 class="mb-0">Customers</h6>
              <div class="d-flex align-items-center gap-2">
                <span class="badge badge-soft" th:text="'Count: ' + ${#lists.size(customers)}">Count: 0</span>
                <div class="input-group input-group-sm" style="width:260px;">
                  <span class="input-group-text"><i class="bi bi-search"></i></span>
                  <input id="searchBox" type="text" class="form-control" placeholder="Search name or contact">
                </div>
              </div>
            </div>

            <div th:if="${#lists.isEmpty(customers)}" class="empty">
              <i class="bi bi-people fs-3 d-block mb-2"></i>
              No customers yet. Create your first customer using the form on the left.
            </div>

            <div th:unless="${#lists.isEmpty(customers)}" class="table-responsive mt-2">
              <table class="table table-hover align-middle" id="customersTable">
                <thead>
                  <tr>
                    <th style="width:80px;">ID</th>
                    <th>Name</th>
                    <th>Contact</th>
                    <th>Email</th>
                    <th style="width:140px;">Actions</th>
                  </tr>
                </thead>
                <tbody id="customersBody">
                  <tr th:each="cust : ${customers}">
                    <td th:text="${cust.id}"></td>
                    <td th:text="${cust.name}"></td>
                    <td th:text="${cust.contact}"></td>
                    <td th:text="${cust.email} ?: 'â€”'"></td>
                    <td>
                      <a class="btn btn-sm btn-outline-primary"
                         th:href="@{/customers/edit/{id}(id=${cust.id})}">
                        <i class="bi bi-pencil-square me-1"></i> Edit
                      </a>
                      <a class="btn btn-sm btn-outline-danger"
                         th:href="@{/customers/delete/{id}(id=${cust.id})}"
                         onclick="return confirm('Delete this customer?');">
                        <i class="bi bi-trash3 me-1"></i> Delete
                      </a>
                    </td>
                  </tr>
                </tbody>
              </table>
              <div class="small text-secondary mt-2">Tip: Use the search box to quickly filter customers.</div>
            </div>

          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // Client-side form validation (Bootstrap)
    (function () {
      'use strict';
      const forms = document.querySelectorAll('.needs-validation');
      Array.from(forms).forEach(form => {
        form.addEventListener('submit', event => {
          if (!form.checkValidity()) {
            event.preventDefault();
            event.stopPropagation();
          }
          form.classList.add('was-validated');
        }, false);
      });
    })();

    // Simple client-side filtering of the customers table
    const searchBox = document.getElementById('searchBox');
    const tbody = document.getElementById('customersBody');

    function normalize(s){ return (s || '').toLowerCase(); }

    searchBox?.addEventListener('input', (e) => {
      const q = normalize(e.target.value);
      const rows = tbody?.querySelectorAll('tr') || [];
      rows.forEach(tr => {
        const name = normalize(tr.children[1]?.textContent);
        const contact = normalize(tr.children[2]?.textContent);
        const email = normalize(tr.children[3]?.textContent);
        const show = name.includes(q) || contact.includes(q) || email.includes(q);
        tr.style.display = show ? '' : 'none';
      });
    });
  </script>
</body>
</html>
