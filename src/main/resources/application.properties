# =========================
# Server (Railway)
# =========================
server.port=${PORT:8080}
server.address=0.0.0.0

# =========================
# Datasource (Railway / Postgres)
# Set these in KTraders â†’ Variables:
#   SPRING_DATASOURCE_URL=jdbc:postgresql://<HOST>:<PORT>/<DB>?sslmode=require
#   SPRING_DATASOURCE_USERNAME=<USER>
#   SPRING_DATASOURCE_PASSWORD=<PASSWORD>
# =========================
spring.datasource.url=${SPRING_DATASOURCE_URL}
spring.datasource.username=${SPRING_DATASOURCE_USERNAME}
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD}
spring.datasource.driver-class-name=org.postgresql.Driver

# --- HikariCP (safe defaults; override via env if needed) ---
spring.datasource.hikari.pool-name=KTradersHikariPool
spring.datasource.hikari.maximum-pool-size=${DB_MAX_POOL_SIZE:10}
spring.datasource.hikari.minimum-idle=${DB_MIN_IDLE:2}
spring.datasource.hikari.connection-timeout=${DB_CONN_TIMEOUT_MS:30000}   # 30s
spring.datasource.hikari.validation-timeout=${DB_VALID_TIMEOUT_MS:5000}   # 5s
spring.datasource.hikari.idle-timeout=${DB_IDLE_TIMEOUT_MS:600000}        # 10m
spring.datasource.hikari.max-lifetime=${DB_MAX_LIFETIME_MS:1800000}       # 30m
spring.datasource.hikari.initialization-fail-timeout=1                    # fail fast
spring.datasource.hikari.connection-test-query=SELECT 1

# =========================
# JPA / Hibernate
# =========================
spring.jpa.hibernate.ddl-auto=${SPRING_JPA_HIBERNATE_DDL_AUTO:update}
spring.jpa.show-sql=${SPRING_JPA_SHOW_SQL:false}
# Let Hibernate auto-detect Postgres (avoid warning)
# spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect

# Keep timestamps predictable (optional)
spring.jpa.properties.hibernate.jdbc.time_zone=${DB_TIMEZONE:UTC}

# Avoid accidental data.sql/schema.sql in prod
spring.sql.init.mode=${SPRING_SQL_INIT_MODE:never}

# =========================
# File Uploads (use volume or object storage for persistence)
# =========================
app.upload.dir=${APP_UPLOAD_DIR:uploads}
spring.servlet.multipart.max-file-size=10MB
spring.servlet.multipart.max-request-size=10MB

# =========================
# Thymeleaf (cache in prod)
# =========================
spring.thymeleaf.cache=true
spring.thymeleaf.prefix=classpath:/templates/
spring.thymeleaf.suffix=.html

# =========================
# Logging (quiet but useful)
# =========================
logging.level.com.example.demo=INFO
logging.level.org.springframework.web=INFO
logging.level.org.hibernate.SQL=WARN
# Optional startup diagnostics:
# logging.level.com.zaxxer.hikari=DEBUG
# logging.level.org.springframework.boot.autoconfigure.jdbc=DEBUG

# =========================
# App Settings
# =========================
app.forecast.confidence.threshold=0.6
app.forecast.seasons.enabled=true
app.reorder.threshold=10

# =========================
# Errors & Actuator
# =========================
server.error.include-message=always
server.error.include-stacktrace=never
management.endpoints.web.exposure.include=health,info
